<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hack University ‚Ä¢ Student Portal Lookup</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Google Sans','Roboto',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      background:#f8f9fa;
      color:#202124;
      min-height:100vh;
    }

    /* NAV */
    .navbar{
      background:#fff;
      border-bottom:1px solid #e8eaed;
      padding:12px 0;
      position:sticky;
      top:0;
      z-index:100;
    }
    .nav-container{
      max-width:1100px;
      margin:0 auto;
      padding:0 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .nav-brand a{
      color:#4285f4;
      text-decoration:none;
      font-size:22px;
      font-weight:600;
    }
    .nav-links{
      display:flex;
      gap:20px;
      flex-wrap:wrap;
    }
    .nav-link{
      color:#5f6368;
      text-decoration:none;
      font-size:14px;
      padding:8px 12px;
      border-radius:6px;
    }
    .nav-link:hover{
      background:#f1f3f4;
      color:#1a73e8;
    }

    /* Timezone band */
    .timezone-section{
      background:#ffffff;
      border-bottom:1px solid #e8eaed;
      padding:24px 20px;
      margin-bottom:24px;
    }
    .timezone-header{text-align:center;margin-bottom:18px}
    .timezone-header h2{color:#202124;font-size:24px;font-weight:600}
    .timezone-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:14px;
      max-width:1100px;
      margin:0 auto;
    }
    .timezone-item{
      background:#ffffff;
      border:1px solid #dadce0;
      border-radius:8px;
      padding:14px;
      text-align:center;
      transition:all .2s ease;
    }
    .timezone-item:hover{box-shadow:0 1px 6px rgba(32,33,36,.28)}
    .timezone-flag{font-size:18px;margin-bottom:6px}
    .timezone-time{
      font-size:16px;
      font-weight:600;
      color:#1a73e8;
      margin-bottom:4px;
      font-family:'Roboto Mono',monospace;
    }
    .timezone-location{color:#5f6368;font-size:12px}

    /* Main */
    .container{max-width:1100px;margin:0 auto;padding:24px}
    .header{text-align:center;margin:24px 0}
    .header h1{font-size:30px;font-weight:600}
    .header p{margin-top:10px;color:#5f6368;line-height:1.6}
    .surface{
      background:#fff;
      border:1px solid #dadce0;
      border-radius:12px;
      padding:24px;
    }
    .subtitle{text-align:center;color:#5f6368}
    .helper{
      background:#e3f2fd;
      border:1px solid #bbdefb;
      color:#0d47a1;
      border-radius:8px;
      padding:12px;
      margin:16px 0;
      font-size:14px;
      line-height:1.5;
    }
    .row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .email-input{
      flex:1 1 320px;
      padding:12px;
      border:1px solid #d1d5db;
      border-radius:8px;
      font-size:14px;
    }
    .email-input:focus{
      outline:none;
      border-color:#1a73e8;
      box-shadow:0 0 0 3px rgba(26,115,232,.15);
    }
    .btn{
      padding:12px 16px;
      border-radius:8px;
      border:none;
      cursor:pointer;
      font-weight:700;
      font-size:14px;
    }
    .btn-primary{
      background:#1a73e8;
      color:#fff;
    }
    .btn-primary:hover{background:#1557b0}

    #result{
      margin-top:16px;
      background:#111827;
      color:#d1fae5;
      border-radius:12px;
      padding:16px;
      font-family:monospace;
      font-size:13px;
    }

    .info-box{
      background:#1f2937;
      border-left:4px solid #3b82f6;
      border-radius:8px;
      padding:12px;
      margin-bottom:12px;
      color:#e5e7eb;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    .info-box strong{color:#f9fafb}

    .card-welcome{
      background:#020617;
      border-left:4px solid #22c55e;
      border-radius:8px;
      padding:14px 14px 14px 16px;
      margin:12px 0;
      color:#e5e7eb;
      font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }

    .cta{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:8px;
      margin:10px 0 16px 0;
    }
    .cta a{
      display:block;
      text-align:center;
      color:#fff;
      text-decoration:none;
      font-weight:700;
      padding:10px 14px;
      border-radius:8px;
      font-size:13px;
    }
    .cta-discord{
      background:linear-gradient(45deg,#7289da,#5865f2);
    }
    .cta-groupme{
      background:linear-gradient(45deg,#0ea5e9,#0369a1);
    }
    .cta-org{
      background:linear-gradient(45deg,#4b5563,#1f2937);
    }
    .cta-membership{
      background:linear-gradient(45deg,#16a34a,#22c55e);
    }

    .card-yes{
      background:#052e16;
      border-left:4px solid #22c55e;
      border-radius:8px;
      padding:12px;
      margin-top:8px;
      color:#dcfce7;
      font-size:13px;
    }
    .card-no{
      background:#3f1d1d;
      border-left:4px solid #f97373;
      border-radius:8px;
      padding:12px;
      margin-top:8px;
      color:#fee2e2;
      font-size:13px;
    }

    .card-events{
      background:#020617;
      border-left:4px solid #38bdf8;
      border-radius:8px;
      padding:12px;
      margin-top:10px;
      color:#e5e7eb;
      font-size:13px;
    }
    .card-events ul{
      margin:8px 0 0 18px;
      padding:0;
    }
    .card-events li{
      margin-bottom:6px;
    }
    .card-events a{
      color:#22c55e;
      text-decoration:none;
    }
    .card-events a:hover{text-decoration:underline}

    /* Footer (Hack University) */
    .cc-blue{background:#1a73e8}
    .footer{
      color:#fff;
      padding:32px 0 48px 0;
      margin-top:40px;
    }
    .footer-container{max-width:1200px;margin:0 auto;padding:0 20px}
    .footer-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
      gap:24px;
      margin-bottom:32px;
    }
    .footer h3{font-size:18px;font-weight:500;margin-bottom:16px;color:#fff}
    .footer p{font-size:14px;opacity:.9;margin-bottom:16px;line-height:1.5}
    .footer ul{list-style:none;padding:0;margin:0}
    .footer li{margin-bottom:8px}
    .footer a{color:#fff;text-decoration:none;font-size:14px;opacity:.9;transition:opacity .2s ease}
    .footer a:hover{opacity:1}
    .social-grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:8px;
      margin-top:16px;
    }
    .social-link{
      display:flex;
      flex-direction:column;
      align-items:center;
      color:#fff;
      text-decoration:none;
      padding:8px;
      transition:color .2s ease;
    }
    .social-link:hover{color:#fbbf24}
    .social-link i{font-size:18px;margin-bottom:4px}
    .social-link span{font-size:11px;text-align:center}
    .footer-bottom{
      margin-top:32px;
      padding-top:24px;
      border-top:1px solid rgba(255,255,255,.2);
      text-align:center;
    }
    .footer-bottom p{font-size:14px;opacity:.9;margin-bottom:8px}
    .footer-bottom .credits{font-size:12px;opacity:.85}

    @media (max-width:520px){
      .container{padding:16px}
    }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <a href="https://codecrunchglobal.vercel.app" target="_blank" rel="noopener"><strong>Code Crunch</strong></a>
      </div>
      <div class="nav-links">
        <a href="https://colorstackatfiu.vercel.app/" class="nav-link">ColorStack at FIU</a>
        <a href="https://cahsiatfiu.vercel.app/" class="nav-link">CAHSI at FIU</a>
        <a href="https://gdgatfiu.vercel.app/" class="nav-link">GDG at FIU</a>
        <a href="https://raspberrypicrunch.vercel.app/" class="nav-link">Raspberry Pi Code Crunch</a>
        <a href="https://codecrunchglobal.vercel.app/hackuniversitydonate.html" class="nav-link">Support Us</a>
      </div>
    </div>
  </nav>

  <!-- TIMEZONE BAND -->
  <div class="timezone-section">
    <div class="timezone-header">
      <h2>üèÜ Hack University HQ</h2>
    </div>
    <div class="timezone-grid">
      <div class="timezone-item">
        <div class="timezone-flag">üá∫üá∏ - HQ</div>
        <div class="timezone-time" id="miami-time">--:--:--</div>
        <div class="timezone-location">Miami, FL (EST)</div>
      </div>
      <div class="timezone-item">
        <div class="timezone-flag">üá™üá∫</div>
        <div class="timezone-time" id="london-time">--:--:--</div>
        <div class="timezone-location">London (GMT)</div>
      </div>
      <div class="timezone-item">
        <div class="timezone-flag">üåç</div>
        <div class="timezone-time" id="lagos-time">--:--:--</div>
        <div class="timezone-location">Lagos (WAT)</div>
      </div>
      <div class="timezone-item">
        <div class="timezone-flag">üåè</div>
        <div class="timezone-time" id="tokyo-time">--:--:--</div>
        <div class="timezone-location">Tokyo (JST)</div>
      </div>
      <div class="timezone-item">
        <div class="timezone-flag">üá¶üá∫</div>
        <div class="timezone-time" id="sydney-time">--:--:--</div>
        <div class="timezone-location">Sydney (AEDT)</div>
      </div>
      <div class="timezone-item">
        <div class="timezone-flag">üáÆüá≥</div>
        <div class="timezone-time" id="mumbai-time">--:--:--</div>
        <div class="timezone-location">Mumbai (IST)</div>
      </div>
    </div>
  </div>

  <main class="container">
    <!-- Header -->
    <section class="header">
      <h1>Hack University Student Portal Lookup</h1>
      <p class="subtitle">
        Enter the same email you used on the <strong>Hack University One-Stop Registration Form</strong> to review your hackathon & business competition registrations, claim perks, and join our communities.
      </p>
    </section>

    <!-- Login -->
    <section class="surface">
      <div class="helper">
        <strong>Who can use this portal?</strong><br/>
        This portal is for students and participants who registered for any Hack University / Code Crunch hackathon or business competition using their email. If you don‚Äôt see your record, make sure you submitted the latest version of the One-Stop form.
      </div>

      <div class="row">
        <input id="emailInput" class="email-input" type="email" placeholder="your@email.com"/>
        <button class="btn btn-primary" onclick="checkStudentRegistrationStatus()">Look up my registration</button>
      </div>

      <div id="result" style="margin-top:12px;">
        <div class="info-box">
          <strong>üìã What you‚Äôll see here:</strong><br/>
          ‚Ä¢ Confirmation if your email is on file for Hack University / Code Crunch events<br/>
          ‚Ä¢ Your latest registration timestamp, name, and institution<br/>
          ‚Ä¢ A list of hackathons / competitions where you selected <em>Yes</em><br/>
          ‚Ä¢ Perks links for each registered event<br/>
          ‚Ä¢ Quick-access buttons to Discord, GroupMe, and organization membership links
        </div>
        Awaiting email‚Ä¶
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="cc-blue footer">
    <div class="footer-container">
      <div class="footer-grid">
        <div>
          <h3>Hack University <span>üë®üèª‚Äçüíªüë©üèΩ‚Äçüíªüßëüèø‚Äçüíª</span></h3>
          <p>
            A collaborative effort uniting multiple student organizations and global communities with a mission to empower the next generation of innovators, developers, and leaders.
          </p>
          <p><a href="https://hackuniversity.vercel.app" target="_blank" rel="noopener">HackUniversity.vercel.app</a></p>

          <div>
            <h4 style="font-size:14px;font-weight:500;margin-bottom:12px;">Connect With Us:</h4>
            <div class="social-grid">
              <a href="#" class="social-link"><i class="fab fa-linkedin"></i><span>LinkedIn</span></a>
              <a href="#" class="social-link"><i class="fab fa-instagram"></i><span>Instagram</span></a>
              <a href="#" class="social-link"><i class="fab fa-github"></i><span>GitHub</span></a>
              <a href="#" class="social-link"><i class="fab fa-youtube"></i><span>YouTube</span></a>
              <a href="#" class="social-link"><i class="fab fa-discord"></i><span>Discord</span></a>
              <a href="#" class="social-link"><i class="far fa-calendar-alt"></i><span>Calendar</span></a>
            </div>
          </div>
        </div>

        <div>
          <h3>Quick Links</h3>
          <ul>
            <li><a href="#">Mission</a></li>
            <li><a href="#">Events</a></li>
            <li><a href="#">Hackathons</a></li>
            <li><a href="#">Membership</a></li>
            <li><a href="#">Join E-Board</a></li>
            <li><a href="#">Resources</a></li>
            <li><a href="#">Join Discord</a></li>
          </ul>
        </div>

        <div>
          <h3>Contact</h3>
          <div style="font-size:14px;opacity:.9;">
            Miami, FL<br/>
            <a href="mailto:codecrunchclub@gmail.com">codecrunchclub@gmail.com</a>
          </div>
        </div>
      </div>

      <div class="footer-bottom">
        <p>¬© <span id="year"></span> Hack University. All rights reserved.</p>
        <div class="credits">
          Built with ‚ù§Ô∏è for the tech community by <a href="#" target="_blank">Brian Bazurto</a> | Powered by innovation and collaboration
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ====== CONFIG ======
    const ALLOWED_HOST = "codecrunchglobal.vercel.app";
    // NOTE: replace this with the new Apps Script deployment URL for the STUDENT API
    const API_URL = "https://script.google.com/macros/s/AKfycbxjud0yLqQr8HEbPlLgMeXXrxBHDEGUXqMgJfFDb3lYM5-QpAwy40cVl3vfNORLyNPPbA/exec";
    const USE_API_KEY = false;
    const API_KEY     = "REPLACE_WITH_SECURE";

    // Prefill email from ?email=
    const prefill = new URLSearchParams(location.search).get('email');
    if (prefill) document.getElementById('emailInput').value = prefill;

    function domainOK() {
      const ok = window.location.hostname === ALLOWED_HOST;
      if (!ok) {
        document.getElementById('result').innerHTML =
          `<div class="info-box">‚ùå This portal only works on <strong>${ALLOWED_HOST}</strong>.</div>`;
      }
      return ok;
    }

    function infoBoxHTML() {
      return `
        <div class="info-box">
          <strong>üìß Email Verification:</strong><br>
          ‚Ä¢ Use the same email you used on the Hack University One-Stop Registration Form<br>
          ‚Ä¢ This portal is for students / participants in Hack University & Code Crunch events
        </div>`;
    }

    async function checkStudentRegistrationStatus() {
      if (!domainOK()) return;

      const email = (document.getElementById('emailInput').value || '').trim();
      const resultDiv = document.getElementById('result');
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!email) {
        resultDiv.innerHTML = infoBoxHTML() + '‚ùå Please enter your email.';
        return;
      }
      if (!emailRegex.test(email)) {
        resultDiv.innerHTML = infoBoxHTML() + '‚ùå Please enter a valid email.';
        return;
      }

      resultDiv.innerHTML = infoBoxHTML() + '‚è≥ Looking up your registration‚Ä¶';

      try {
        const url = new URL(API_URL);
        url.searchParams.set('email', email);
        url.searchParams.set('referer', window.location.href);
        url.searchParams.set('details', '0');
        if (USE_API_KEY) url.searchParams.set('key', API_KEY);

        const resp = await fetch(url.toString());
        const data = await resp.json();

        if (data.error) {
          resultDiv.innerHTML = infoBoxHTML() + `‚ùå Error: ${data.error}`;
          return;
        }
        if (!Array.isArray(data)) {
          resultDiv.innerHTML = infoBoxHTML() + '‚ùå Unexpected response. Try again later.';
          return;
        }

        let html = infoBoxHTML() + `<strong>Lookup for üìß <span style="color:#f9fafb">${email}</span>:</strong><br/>`;

        if (data.length > 0 && data[0].status && data[0].status !== "No entry") {
          data.forEach(entry => {
            const statusText = entry.status || "Registration found";

            const discordLink = entry.discordHackBusinessLink || entry.discordJoinLink || '#';
            const groupmeLink = entry.groupmeLink || '#';
            const orgLinks = entry.orgLinks || {};
            const membershipPortalLink = entry.membershipPortalLink || '#';

            html += `
              <div class="card-welcome">
                <strong style="color:#22c55e;font-size:1.05em;">üéâ Registration Found ‚Äî Welcome to Hack University!</strong><br/><br/>
                <div style="font-size:13px;line-height:1.5;margin-bottom:10px;">
                  ${entry.studentInstructions
                    ? entry.studentInstructions
                        .replace(/\n/g,'<br/>')
                    : "Review your events below and join our communities."}
                </div>
                <div class="cta">
                  <a class="cta-discord" href="${discordLink}" target="_blank" rel="noopener">üöÄ Join Hackathon & Biz Competition Discord</a>
                  <a class="cta-groupme" href="${groupmeLink}" target="_blank" rel="noopener">üë• Join Hack University GroupMe</a>
                  <a class="cta-org" href="${orgLinks.codeCrunch || '#'}" target="_blank" rel="noopener">üíª Join Code Crunch</a>
                  <a class="cta-org" href="${orgLinks.gdgAtFiu || '#'}" target="_blank" rel="noopener">üåê Join GDG @ FIU</a>
                  <a class="cta-org" href="${orgLinks.colorStackFiu || '#'}" target="_blank" rel="noopener">üé® Join ColorStack @ FIU</a>
                  <a class="cta-org" href="${orgLinks.cahsiFiu || '#'}" target="_blank" rel="noopener">üìö Join CAHSI @ FIU</a>
                  <a class="cta-org" href="${orgLinks.raspberryPiFiu || '#'}" target="_blank" rel="noopener">üçì Join Raspberry Pi Code Crunch</a>
                  <a class="cta-membership" href="${membershipPortalLink}" target="_blank" rel="noopener">üèÖ Get Organization Membership / Certificate</a>
                </div>
              </div>
            `;

            const name = entry?.basicInfo?.name || "Not available";
            const institution = entry?.basicInfo?.institution || "Not available";

            html += `
              <div class="card-yes">
                <strong>‚úÖ Student Record Found</strong><br/>
                ‚Ä¢ Status: ${statusText}<br/>
                ‚Ä¢ Latest Form Timestamp (col F): ${entry.timestamp || "N/A"}<br/>
                ‚Ä¢ Name (col C): ${name}<br/>
                ‚Ä¢ Institution (col E): ${institution}<br/>
                ‚Ä¢ Email (col B): ${entry.email || ""}<br/>
              </div>
            `;

            const eventsSummary = entry.eventsSummary || [];
            if (eventsSummary.length > 0) {
              html += `
                <div class="card-events">
                  <strong>üìö Hackathons & Competitions where you said "Yes":</strong>
                  <ul>
              `;
              eventsSummary.forEach(ev => {
                html += `
                  <li>
                    <strong>${ev.event}</strong><br/>
                    ‚Ä¢ Your response: ${ev.response || "Yes"}<br/>
                    ‚Ä¢ <a href="${ev.perksLink || '#'}" target="_blank" rel="noopener">Claim your event perks here</a>
                  </li>
                `;
              });
              html += `
                  </ul>
                </div>
              `;
            } else {
              html += `
                <div class="card-events">
                  <strong>‚ÑπÔ∏è No events marked as "Yes" yet.</strong><br/>
                  We couldn‚Äôt detect any hackathon or competition where your response contained ‚Äúyes‚Äù.<br/>
                  If this seems wrong, please update your choices in the One-Stop Registration Form and try again after the sheet syncs.
                </div>
              `;
            }
          });

          resultDiv.innerHTML = html;

        } else {
          html += `
            <div class="card-no">
              <strong>‚ùå No Record Found</strong><br/>
              ‚Ä¢ We could not find a Hack University / Code Crunch registration for this email.<br/>
              ‚Ä¢ Make sure you completed the latest One-Stop Registration Form with this exact email (no typos).<br/>
              ‚Ä¢ If you just submitted, give the sheet a bit of time to update before trying again.
            </div>
          `;
          resultDiv.innerHTML = html;
        }

      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = infoBoxHTML() + '‚ùå Network error. Please try again later.';
      }
    }

    // Live time updates for the timezone band
    function updateTimes() {
      const now = new Date();
      const set = (id, tz) => {
        const t = new Date(now.toLocaleString("en-US",{timeZone:tz}));
        const hh = String(t.getHours()).padStart(2,'0');
        const mm = String(t.getMinutes()).padStart(2,'0');
        const ss = String(t.getSeconds()).padStart(2,'0');
        const out = `${hh}:${mm}:${ss}`;
        const el = document.getElementById(id);
        if (el) el.textContent = out;
      };
      set('miami-time',"America/New_York");
      set('london-time',"Europe/London");
      set('lagos-time',"Africa/Lagos");
      set('tokyo-time',"Asia/Tokyo");
      set('sydney-time',"Australia/Sydney");
      set('mumbai-time',"Asia/Kolkata");
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateTimes();
      setInterval(updateTimes, 1000);
    });

    // Enter to submit
    document.getElementById('emailInput').addEventListener('keypress',(e)=>{
      if (e.key === 'Enter') checkStudentRegistrationStatus();
    });
  </script>
</body>
</html>
