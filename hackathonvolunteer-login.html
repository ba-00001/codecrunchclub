<section class="checklist-section" id="volunteer-status-checker" style="margin-top: 3rem;">

    <h2 class="checklist-title glitch" data-text="CHECK OFFICIAL VOLUNTEER STATUS">CHECK OFFICIAL VOLUNTEER STATUS</h2>
    <p style="color: limegreen; font-family: monospace;">Check if you are an <strong>Official Volunteer</strong> (Judge, Speaker, Mentor, etc.) using your <strong>email address</strong> from Form 2:</p>
    
    <div style="background: rgba(0, 255, 153, 0.1); border: 1px solid #00ff99; border-radius: 8px; padding: 1rem; margin: 1rem 0;">
        <p style="margin: 0; color: #00ff99; font-weight: bold;">üìã What happens next:</p>
        <p style="margin: 0.5rem 0; color: #fff;">‚úÖ If you're confirmed as volunteer [form no1 & form no2 completed], you'll see the Discord and GroupMe join links.</p>
        <p style="margin: 0.5rem 0; color: #fff;">‚ùå If not, you'll be prompted to go to <strong>Step 2</strong> to register and wait if you get accepted as volunteer or not</p>
    </div>

    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1rem;">
        <input type="email" id="emailInput" placeholder="Enter your email address (any Google account email)" 
            style="flex: 1 1 300px; padding: 0.5rem; border-radius: 5px; border: 1px solid #ccc; font-size: 1rem;" />
        <button onclick="checkOfficialVolunteerStatus()" 
                style="padding: 0.5rem 1rem; font-size: 1rem; background: #00ff99; color: #000; border: none; border-radius: 5px; cursor: pointer;">
        üìß Check Email Status
        </button>
    </div>
    
    <div id="result" style="margin-top: 1.5rem; background-color: #222; padding: 1rem; border-radius: 8px; color: limegreen; font-family: monospace;">
        <div style="background-color: #1a1a2e; padding: 1rem; border-radius: 8px; border-left: 4px solid #ffa500; margin-bottom: 1rem;">
        <strong style="color: #ffa500;">üìã Email Verification:</strong><br>
        ‚Ä¢ <strong>Any Valid Email</strong>: Gmail, Outlook, Yahoo, or any email used as Google account<br>
        ‚Ä¢ <strong>Official Volunteers</strong>: Judges, Speakers, Mentors, Organizers<br>
        ‚Ä¢ <strong>Form 2 participants</strong>: Those who filled out the volunteer confirmation form<br>
        ‚Ä¢ <strong>Special roles</strong>: People with elevated permissions and responsibilities
        </div>
        Results will appear here...
    </div>

    <script>
        function checkDomain() {
            const allowedDomain = 'codecrunchglobal.vercel.app';
            const currentDomain = window.location.hostname;
            
            if (currentDomain !== allowedDomain) {
                document.getElementById('result').innerHTML = 
                    `‚ùå This tool only works on pages from ${allowedDomain}`;
                return false;
            }
            return true;
        }

        async function checkOfficialVolunteerStatus() {
            if (!checkDomain()) {
                return;
            }

            const inputField = document.getElementById("emailInput");
            let email = inputField.value.trim();
            const resultDiv = document.getElementById("result");
            
            // Preserve the info box
            const infoBox = `<div style="background-color: #1a1a2e; padding: 1rem; border-radius: 8px; border-left: 4px solid #ffa500; margin-bottom: 1rem;">
            <strong style="color: #ffa500;">üìã Email Verification:</strong><br>
            ‚Ä¢ <strong>Any Valid Email</strong>: Gmail, Outlook, Yahoo, or any email used as Google account<br>
            ‚Ä¢ <strong>Official Volunteers</strong>: Judges, Speakers, Mentors, Organizers<br>
            ‚Ä¢ <strong>Form 2 participants</strong>: Those who filled out the volunteer confirmation form<br>
            ‚Ä¢ <strong>Special roles</strong>: People with elevated permissions and responsibilities
            </div>`;
            
            if (!email) {
                resultDiv.innerHTML = infoBox + '‚ùå Please enter your email address from Form 2.';
                return;
            }

            // Email validation (any valid email format)
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                resultDiv.innerHTML = infoBox + '‚ùå Please enter a valid email address.';
                return;
            }

            resultDiv.innerHTML = infoBox + '‚è≥ Checking email address in official volunteer database...';

            // ========================================
            // üîÑ UPDATED API URL - USE YOUR NEW DEPLOYMENT URL
            // ========================================
            const apiUrl = "https://script.google.com/macros/s/AKfycbz0FkcYV_Wkt5Iv1BKzJw6KXIoqXgfyBPDfAVRlLjsJbZ1Iq9eqX-hT5EEkTJGxNgfs5w/exec";
            
            try {
                const currentUrl = window.location.href;
                const response = await fetch(`${apiUrl}?email=${encodeURIComponent(email)}&referer=${encodeURIComponent(currentUrl)}`);
                const data = await response.json();
                
                if (data.error) {
                    resultDiv.innerHTML = infoBox + `‚ùå Error: ${data.error}`;
                    return;
                }

                // ========================================
                // üîÑ UPDATED: Handle new response format
                // ========================================
                if (Array.isArray(data)) {
                    let html = infoBox + `<strong>Official Volunteer Status for "üìß <span style="color:white">${email}</span>":</strong><br>`;
                    
                    if (data.length > 0 && data[0].status !== "No entry") {
                        data.forEach((entry) => {
                            // Discord Server and Channel Section
                            if (entry.discordInstructions && entry.discordJoinLink && entry.privateChannelLink) {
                                html += `<div style="background-color: #1a1a2e; padding: 1.5rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #00ff99; box-shadow: 0 2px 10px rgba(0,255,153,0.1);">`;
                                html += `<strong style="color: #00ff99; font-size: 1.1em;">üéâ Welcome to the Official Volunteer Team!</strong><br><br>`;
                                
                                // Discord join link
                                html += `<div style="background: linear-gradient(45deg, #7289da, #5865f2); padding: 10px 15px; border-radius: 8px; margin: 8px 0; text-align: center; box-shadow: 0 4px 15px rgba(114, 137, 218, 0.3);">`;
                                html += `<a href="${entry.discordJoinLink}" target="_blank" style="color: white; text-decoration: none; font-weight: bold; font-size: 1.1em;">üöÄ JOIN DISCORD SERVER üöÄ</a>`;
                                html += `</div>`;
                                
                                // Private channel link
                                html += `<div style="background: linear-gradient(45deg, #43b581, #4caf50); padding: 10px 15px; border-radius: 8px; margin: 8px 0; text-align: center; box-shadow: 0 4px 15px rgba(67, 181, 129, 0.3);">`;
                                html += `<a href="${entry.privateChannelLink}" target="_blank" style="color: white; text-decoration: none; font-weight: bold; font-size: 1.1em;">üîí CHECK PRIVATE CHANNEL ACCESS üîí</a>`;
                                html += `</div>`;
                                
                                // Discord instructions
                                let formattedInstructions = entry.discordInstructions
                                    .replace(/\n/g, '<br>')
                                    .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #fff;">$1</strong>')
                                    .replace(/`(.*?)`/g, '<code style="background: #333; padding: 2px 6px; border-radius: 3px; color: #ffaa00;">$1</code>');
                                
                                html += `<br>${formattedInstructions}`;
                                html += `</div>`;
                            }
                            
                            // Basic volunteer status information
                            html += `<div style="background-color: #1a4a1a; padding: 1rem; border-radius: 8px; border-left: 4px solid #00ff99; margin-top: 1rem;">`;
                            html += `<strong style="color: #00ff99;">‚úÖ CONFIRMED OFFICIAL VOLUNTEER</strong><br>`;
                            html += `‚Ä¢ Role/Status: ${entry.status}<br>`;
                            html += `‚Ä¢ Form 2 Submitted: ${entry.timestamp || 'N/A'}<br>`;
                            html += `‚Ä¢ Verified Email: ${entry.email}<br>`;
                            
                            // ========================================
                            // üîÑ UPDATED: Display dynamic columns
                            // ========================================
                            // Show position if available
                            if (entry.position && entry.position !== "Not available") {
                                html += `‚Ä¢ Position: ${entry.position}<br>`;
                            }
                            
                            // Show company if available
                            if (entry.company && entry.company !== "Not available") {
                                html += `‚Ä¢ Company: ${entry.company}<br>`;
                            }
                            
                            // Show Discord username if available
                            if (entry.discordUsername && entry.discordUsername !== "Not available") {
                                html += `‚Ä¢ Discord: ${entry.discordUsername}<br>`;
                            }
                            
                            // Show GitHub profile if available
                            if (entry.githubProfile && entry.githubProfile !== "Not available") {
                                html += `‚Ä¢ GitHub: <a href="${entry.githubProfile}" target="_blank" style="color: #00ff99;">${entry.githubProfile}</a><br>`;
                            }
                            
                            html += `</div>`;
                            
                            // ========================================
                            // üîÑ UPDATED: Show ALL additional columns you added
                            // ========================================
                            // Collect all extra fields (excluding the standard ones)
                            const standardFields = ['timestamp', 'email', 'position', 'company', 'discordUsername', 'githubProfile', 'status', 'discordJoinLink', 'privateChannelLink', 'discordInstructions'];
                            const extraFields = Object.keys(entry).filter(key => !standardFields.includes(key));
                            
                            if (extraFields.length > 0) {
                                html += `<div style="background-color: #2a2a1a; padding: 1rem; border-radius: 8px; border-left: 4px solid #ffaa00; margin-top: 1rem;">`;
                                html += `<strong style="color: #ffaa00;">üéØ VOLUNTEER PREFERENCES & ADDITIONAL INFO:</strong><br><br>`;
                                
                                extraFields.forEach((fieldName) => {
                                    const value = entry[fieldName];
                                    
                                    // Skip if not available
                                    if (!value || value === "Not available") return;
                                    
                                    // Clean up field name for display
                                    let cleanFieldName = fieldName
                                        .replace(/([A-Z])/g, ' $1') // Add space before capital letters
                                        .replace(/^./, str => str.toUpperCase()) // Capitalize first letter
                                        .trim();
                                    
                                    // Color code the responses
                                    let responseColor = '#ccc'; // Default gray
                                    const lowerValue = value.toString().toLowerCase();
                                    
                                    if (lowerValue.includes('yes')) {
                                        responseColor = '#00ff99'; // Green for positive responses
                                    } else if (lowerValue === 'no') {
                                        responseColor = '#ff6b6b'; // Red for no
                                    }
                                    
                                    html += `<div style="margin-bottom: 0.8rem; padding: 0.5rem; background-color: #1a1a1a; border-radius: 4px;">`;
                                    html += `<strong style="color: #fff; font-size: 0.9em;">${cleanFieldName}</strong><br>`;
                                    html += `<span style="color: ${responseColor}; font-weight: bold;">‚Üí ${value}</span>`;
                                    html += `</div>`;
                                });
                                
                                html += `</div>`;
                                
                                // Show summary of "Yes" responses
                                const yesResponses = extraFields.filter(key => {
                                    const val = entry[key];
                                    return val && val.toString().toLowerCase().includes('yes');
                                });
                                
                                if (yesResponses.length > 0) {
                                    html += `<div style="background-color: #1a2a1a; padding: 1rem; border-radius: 8px; border-left: 4px solid #00ff99; margin-top: 1rem;">`;
                                    html += `<strong style="color: #00ff99;">‚úÖ SUMMARY - Your Active Volunteer Commitments:</strong><br>`;
                                    
                                    yesResponses.forEach((fieldName) => {
                                        let cleanName = fieldName
                                            .replace(/([A-Z])/g, ' $1')
                                            .replace(/^./, str => str.toUpperCase())
                                            .trim();
                                        
                                        html += `‚Ä¢ <strong>${cleanName}</strong>: <span style="color: #00ff99;">${entry[fieldName]}</span><br>`;
                                    });
                                    
                                    html += `</div>`;
                                }
                            }
                        });
                    } else {
                        // Not found
                        html += `<div style="background-color: #4a1a1a; padding: 1rem; border-radius: 8px; border-left: 4px solid #ff6b6b; margin-top: 1rem;">`;
                        html += `<strong style="color: #ff6b6b;">‚ùå NOT AN OFFICIAL VOLUNTEER</strong><br>`;
                        html += `‚Ä¢ Status: No entry found in Form 2 database<br>`;
                        html += `‚Ä¢ Email: ${email}<br>`;
                        html += `‚Ä¢ This means you are not registered as a Judge, Speaker, Mentor, or Organizer<br>`;
                        html += `‚Ä¢ Make sure you're using the same email address from Form 2<br>`;
                        html += `</div>`;
                    }
                    
                    resultDiv.innerHTML = html;
                }

            } catch (error) {
                console.error('Error checking status:', error);
                resultDiv.innerHTML = infoBox + '‚ùå Failed to check official volunteer status. Please try again later.';
            }
        }

        // Allow Enter key to trigger search
        document.getElementById('emailInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkOfficialVolunteerStatus();
            }
        });
    </script>
</section>