<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Volunteer Login ‚Ä¢ Code Crunch</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Google Sans','Roboto',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:#f8f9fa;color:#202124;min-height:100vh}
    .navbar{background:#fff;border-bottom:1px solid #e8eaed;padding:12px 0;position:sticky;top:0;z-index:100}
    .nav-container{max-width:1100px;margin:0 auto;padding:0 20px;display:flex;justify-content:space-between;align-items:center}
    .nav-brand a{color:#4285f4;text-decoration:none;font-size:22px;font-weight:600}
    .nav-links{display:flex;gap:20px}
    .nav-link{color:#5f6368;text-decoration:none;font-size:14px;padding:8px 12px;border-radius:6px}
    .nav-link:hover{background:#f1f3f4;color:#1a73e8}
    .container{max-width:1100px;margin:0 auto;padding:24px}
    .header{text-align:center;margin:24px 0}
    .header h1{font-size:32px;font-weight:600}
    .header p{margin-top:10px;color:#5f6368;line-height:1.6}
    .surface{background:#fff;border:1px solid #dadce0;border-radius:12px;padding:24px}
    .title{font-size:22px;font-weight:600;text-align:center;margin-bottom:8px}
    .subtitle{text-align:center;color:#5f6368}
    .helper{background:#fff7ed;border:1px solid #ffedd5;color:#7c2d12;border-radius:8px;padding:12px;margin:16px 0}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .email-input{flex:1 1 320px;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:14px}
    .email-input:focus{outline:none;border-color:#1a73e8;box-shadow:0 0 0 3px rgba(26,115,232,.15)}
    .btn{padding:12px 16px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
    .btn-primary{background:#1a73e8;color:#fff}
    .btn-primary:hover{background:#1557b0}
    #result{margin-top:16px;background:#111827;color:#d1fae5;border-radius:12px;padding:16px;font-family:monospace}
    .info-box{background:#1a1a2e;border-left:4px solid #ffa500;border-radius:8px;padding:12px;margin-bottom:12px;color:#fff}
    .card-welcome{background:#0f172a;border-left:4px solid #00ff99;border-radius:8px;padding:16px;margin:12px 0}
    .cta{display:grid;gap:8px;margin:10px 0}
    .cta a{display:block;text-align:center;color:#fff;text-decoration:none;font-weight:700;padding:10px 14px;border-radius:8px}
    .cta-discord{background:linear-gradient(45deg,#7289da,#5865f2)}
    .cta-private{background:linear-gradient(45deg,#43b581,#4caf50)}
    .card-yes{background:#052e16;border-left:4px solid #00ff99;border-radius:8px;padding:12px;margin-top:8px}
    .card-no{background:#3f1d1d;border-left:4px solid #ff6b6b;border-radius:8px;padding:12px;margin-top:8px}
    .resources{margin-top:28px;display:none}
    .resources h2{font-size:20px;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:14px}
    .res-card{background:#fff;border:1px solid #dadce0;border-radius:10px;padding:16px}
    .res-card h3{font-size:16px;margin-bottom:6px;display:flex;align-items:center;gap:8px}
    .res-card p{color:#5f6368;font-size:14px;line-height:1.5;margin-bottom:10px}
    .res-card a{display:inline-block;background:#1a73e8;color:#fff;text-decoration:none;padding:8px 12px;border-radius:8px;font-weight:600}
    .res-card a:hover{background:#1557b0}
    .res-locked{opacity:.6;filter:grayscale(1)}
    .res-locked .lock{color:#d33b01}
    .footer{margin-top:40px;background:#1a73e8;color:#fff}
    .footer-inner{max-width:1100px;margin:0 auto;padding:24px;text-align:center}
    .muted a{color:#fff;opacity:.85;text-decoration:none}
    .muted a:hover{opacity:1}
    @media (max-width:520px){.container{padding:16px}}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand"><a href="https://codecrunchglobal.vercel.app" target="_blank" rel="noopener">Code Crunch</a></div>
      <div class="nav-links">
        <a class="nav-link" href="https://codecrunchglobal.vercel.app">Home</a>
        <a class="nav-link" href="#">Volunteer Wiki</a>
        <a class="nav-link" href="#">Contact</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <!-- Your copy -->
    <section class="header">
      <h1>Volunteer Login</h1>
      <p>
        Enter the email you used to register. We‚Äôll check it against the volunteer list.
        <br><br>
        ‚Ä¢ Direct links to join Discord and verify private-channel access
        <br>
        <strong>Hack & Club Volunteer Login</strong>
      </p>
    </section>

    <!-- Login -->
    <section class="surface" id="volunteer-login">
      <h2 class="title">Check Your Status</h2>
      <p class="subtitle">Use the same email you confirmed with on <strong>Form No. 2</strong>.</p>

      <div class="helper">
        <strong>Accepted Volunteers Only:</strong> Access is restricted to current volunteers who have been accepted and completed Form No. 2.
      </div>

      <div class="row">
        <input id="emailInput" class="email-input" type="email" placeholder="your@email.com"/>
        <button class="btn btn-primary" onclick="checkOfficialVolunteerStatus()">Sign In</button>
      </div>

      <div id="result">
        <div class="info-box">
          <strong>üìã What you'll see if confirmed:</strong><br/>
          ‚Ä¢ Direct links to join Discord and verify private-channel access<br/>
          ‚Ä¢ Your confirmed role + Form-2 timestamp
        </div>
        Awaiting email‚Ä¶
      </div>
    </section>

    <!-- Resources (locked until verified) -->
    <section class="resources" id="resources">
      <h2>Volunteer Resources</h2>
      <div class="grid">
        <div class="res-card res-locked" id="card-cert">
          <h3><i class="fa-solid fa-certificate"></i> Certificates <span class="lock">üîí</span></h3>
          <p>Access or verify volunteer participation certificates.</p>
          <a href="#" id="link-cert" target="_blank" rel="noopener" aria-disabled="true">Open</a>
        </div>
          <div class="res-card res-locked" id="card-expo">
          <h3><i class="fa-solid fa-file-lines"></i> Event Registration Forms <span class="lock">üîí</span></h3>
          <p>Hack and Event registration forms.</p>
          <a href="#" id="link-expo" target="_blank" rel="noopener" aria-disabled="true">Open</a>
        </div>
        <div class="res-card res-locked" id="card-resp">
          <h3><i class="fa-solid fa-table-list"></i> Event Registration Response Sheet <span class="lock">üîí</span></h3>
          <p>Review registration responses compiled from the event form.</p>
          <a href="#" id="link-resp" target="_blank" rel="noopener" aria-disabled="true">Open</a>
        </div>
        <div class="res-card res-locked" id="card-eval">
          <h3><i class="fa-solid fa-clipboard-check"></i> Hackathon Evaluation <span class="lock">üîí</span></h3>
          <p>Judging evaluation forms [Access granted only to volunteers registered by each event]</p>
          <a href="#" id="link-eval" target="_blank" rel="noopener" aria-disabled="true">Open</a>
        </div>

      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="muted">¬© <span id="year"></span> Code Crunch ‚Ä¢ <a href="#">Privacy</a> ‚Ä¢ <a href="#">Terms</a></div>
    </div>
  </footer>

  <script>
    // Footer year
    document.getElementById('year').textContent = new Date().getFullYear();

    // ====== CONFIG ======
    const ALLOWED_HOST = "codecrunchglobal.vercel.app";
    const API_URL = "https://script.google.com/macros/s/AKfycbw8KAqiULOrPefzNs1XRo-PdeJNfDaTYBiVL5jEoL435PeStgoxKmk6_auoH7jnx2Aw5w/exec";
    const USE_API_KEY = false;
    const API_KEY     = "REPLACE_WITH_SECURE";

    // Optional fallbacks if API doesn't send a link (kept here but not required)
    const RESOURCE_LINKS_FALLBACK = {
      certificates: "#",
      responses:    "#",
      evaluation:   "#",
      expo:         "#"
    };

    // Prefill email from ?email=
    const prefill = new URLSearchParams(location.search).get('email');
    if (prefill) document.getElementById('emailInput').value = prefill;

    function domainOK() {
      const ok = window.location.hostname === ALLOWED_HOST;
      if (!ok) {
        document.getElementById('result').innerHTML =
          `<div class="info-box">‚ùå This portal only works on <strong>${ALLOWED_HOST}</strong>.</div>`;
      }
      return ok;
    }

    function infoBoxHTML(){ return `
      <div class="info-box">
        <strong>üìã Email Verification:</strong><br>
        ‚Ä¢ Use the email you used to register and confirm on <strong>Form No. 2</strong><br>
        ‚Ä¢ Accepted volunteers only (Judges, Mentors, Speakers, Organizers)
      </div>`; }

    // Apply resource links from API (with fallback)
    function applyResourceLinksFromAPI(entry) {
      // API fields you return in Apps Script:
      // certificatesLink, eventRegistrationResponseSheetLink, hackathonEvaluationFormsLink
      const cert = entry.certificatesLink || RESOURCE_LINKS_FALLBACK.certificates;
      const resp = entry.eventRegistrationResponseSheetLink || RESOURCE_LINKS_FALLBACK.responses;
      const evalL = entry.hackathonEvaluationFormsLink || RESOURCE_LINKS_FALLBACK.evaluation;

      // If you later add expoFormsLink to the API, prefer it here:
      const expo = entry.expoFormsLink || RESOURCE_LINKS_FALLBACK.expo;

      // Show section
      document.getElementById('resources').style.display = 'block';

      // Map to cards/anchors
      const map = [
        { card: 'card-cert', link: 'link-cert', href: cert },
        { card: 'card-resp', link: 'link-resp', href: resp },
        { card: 'card-eval', link: 'link-eval', href: evalL },
        { card: 'card-expo', link: 'link-expo', href: expo }
      ];

      map.forEach(({card, link, href}) => {
        const cardEl = document.getElementById(card);
        const aEl = document.getElementById(link);
        aEl.href = href || "#";
        aEl.removeAttribute('aria-disabled');
        cardEl.classList.remove('res-locked');
        const lock = cardEl.querySelector('.lock');
        if (lock) lock.remove();
      });
    }

    async function checkOfficialVolunteerStatus() {
      if (!domainOK()) return;

      const email = (document.getElementById('emailInput').value || '').trim();
      const resultDiv = document.getElementById('result');
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

      if (!email) { resultDiv.innerHTML = infoBoxHTML() + '‚ùå Please enter your email.'; return; }
      if (!emailRegex.test(email)) { resultDiv.innerHTML = infoBoxHTML() + '‚ùå Please enter a valid email.'; return; }

      resultDiv.innerHTML = infoBoxHTML() + '‚è≥ Verifying your volunteer status‚Ä¶';

      try {
        const url = new URL(API_URL);
        url.searchParams.set('email', email);
        url.searchParams.set('referer', window.location.href);
        url.searchParams.set('details', '0'); // keep payload lean
        if (USE_API_KEY) url.searchParams.set('key', API_KEY);

        const resp = await fetch(url.toString());
        const data = await resp.json();

        if (data.error) { resultDiv.innerHTML = infoBoxHTML() + `‚ùå Error: ${data.error}`; return; }
        if (!Array.isArray(data)) { resultDiv.innerHTML = infoBoxHTML() + '‚ùå Unexpected response. Try again later.'; return; }

        let html = infoBoxHTML() + `<strong>Login for üìß <span style="color:#fff">${email}</span>:</strong><br/>`;

        if (data.length > 0 && data[0].status && data[0].status !== "No entry") {
          // VERIFIED
          data.forEach(entry => {
            // Discord CTAs using API links
            if (entry.discordInstructions && entry.discordJoinLink && entry.privateChannelLink) {
              html += `<div class="card-welcome">
                        <strong style="color:#00ff99;font-size:1.05em;">üéâ Access Granted ‚Äî Welcome!</strong><br/><br/>
                        <div class="cta">
                          <a class="cta-discord" href="${entry.discordJoinLink}" target="_blank" rel="noopener">üöÄ JOIN DISCORD SERVER</a>
                          <a class="cta-private" href="${entry.privateChannelLink}" target="_blank" rel="noopener">üîí CHECK PRIVATE CHANNEL ACCESS</a>
                        </div>` +
                        entry.discordInstructions
                          .replace(/\n/g,'<br/>')
                          .replace(/\*\*(.*?)\*\*/g,'<strong style="color:#fff">$1</strong>')
                          .replace(/`(.*?)`/g,'<code style="background:#333;padding:2px 6px;border-radius:3px;color:#ffaa00;">$1</code>') +
                      `</div>`;
            }

            // Confirm card
            html += `<div class="card-yes">
                      <strong>‚úÖ Confirmed Volunteer</strong><br/>
                      ‚Ä¢ Status: ${entry.status}<br/>
                      ‚Ä¢ Form-2 Timestamp: ${entry.timestamp}<br/>
                      ‚Ä¢ Email: ${entry.email}<br/>` +
                      (entry?.basicInfo?.position && entry.basicInfo.position!=="Not available" ? `‚Ä¢ Position: ${entry.basicInfo.position}<br/>` : '') +
                      (entry?.basicInfo?.company && entry.basicInfo.company!=="Not available" ? `‚Ä¢ Company: ${entry.basicInfo.company}<br/>` : '') +
                      (entry?.basicInfo?.discordUsername && entry.basicInfo.discordUsername!=="Not available" ? `‚Ä¢ Discord: ${entry.basicInfo.discordUsername}<br/>` : '') +
                      (entry?.basicInfo?.githubProfile && entry.basicInfo.githubProfile!=="Not available" ? `‚Ä¢ GitHub: <a href="${entry.basicInfo.githubProfile}" target="_blank" style="color:#00ff99;">${entry.basicInfo.githubProfile}</a><br/>` : '') +
                    `</div>`;

            // üîì Unlock resources using links from the API
            applyResourceLinksFromAPI(entry);
          });

          resultDiv.innerHTML = html;

        } else {
          // NOT VERIFIED
          html += `<div class="card-no">
                    <strong>‚ùå Access Denied</strong><br/>
                    ‚Ä¢ We could not find a confirmed Form-2 entry for this email.<br/>
                    ‚Ä¢ This portal is restricted to current, accepted volunteers who completed Form No. 2.
                  </div>`;
          resultDiv.innerHTML = html;
        }

      } catch (err) {
        console.error(err);
        resultDiv.innerHTML = infoBoxHTML() + '‚ùå Network error. Please try again later.';
      }
    }

    // Enter to submit
    document.getElementById('emailInput').addEventListener('keypress',(e)=>{
      if (e.key === 'Enter') checkOfficialVolunteerStatus();
    });
  </script>
</body>
</html>
