<!DOCTYPE html>
<html>
<head>
    <title>Simple Form Checker</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        input { padding: 10px; margin: 10px 0; width: 300px; font-size: 16px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; font-size: 16px; }
        button:disabled { opacity: 0.6; }
        .result { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 5px; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th, .data-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .data-table th { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>Check Your Form Responses</h1>
    
    <div>
        <input type="email" id="email" placeholder="Enter your email" value="codecrunchclub01@gmail.com">
        <button onclick="checkEmail()">Check Responses</button>
    </div>
    
    <div id="result"></div>

    <script>
        async function checkEmail() {
            const email = document.getElementById('email').value.trim();
            const resultDiv = document.getElementById('result');
            const button = document.querySelector('button');
            
            if (!email) {
                resultDiv.innerHTML = '<div class="result error">Please enter an email address</div>';
                return;
            }
            
            button.disabled = true;
            button.textContent = 'Checking...';
            resultDiv.innerHTML = '<div class="result">Searching...</div>';
            
            try {
                // Using script tag to avoid CORS
                const script = document.createElement('script');
                const callback = 'callback' + Date.now();
                
                window[callback] = function(data) {
                    document.head.removeChild(script);
                    delete window[callback];
                    button.disabled = false;
                    button.textContent = 'Check Responses';
                    
                    if (data.error) {
                        resultDiv.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                        return;
                    }
                    
                    if (data.found === 0) {
                        resultDiv.innerHTML = '<div class="result">No responses found for this email</div>';
                        return;
                    }
                    
                    let html = `<div class="result success">Found ${data.found} response(s)!</div>`;
                    
                    if (data.data.length > 0) {
                        html += '<table class="data-table"><thead><tr>';
                        
                        // Headers
                        data.headers.forEach(header => {
                            html += `<th>${header}</th>`;
                        });
                        html += '</tr></thead><tbody>';
                        
                        // Data rows
                        data.data.forEach(row => {
                            html += '<tr>';
                            row.forEach(cell => {
                                html += `<td>${cell || 'N/A'}</td>`;
                            });
                            html += '</tr>';
                        });
                        html += '</tbody></table>';
                    }
                    
                    resultDiv.innerHTML = html;
                };
                
                script.onerror = function() {
                    document.head.removeChild(script);
                    delete window[callback];
                    button.disabled = false;
                    button.textContent = 'Check Responses';
                    resultDiv.innerHTML = '<div class="result error">Failed to load data</div>';
                };
                
                script.src = `https://script.google.com/macros/s/AKfycbz5ObccmS8ifCws51ruq5rBcPoFURWjn2i-hWDdfmj7jmxlcoyI9YzdzZHEf7C83tuCJA/exec?email=${encodeURIComponent(email)}&callback=${callback}`;
                document.head.appendChild(script);
                
            } catch (error) {
                button.disabled = false;
                button.textContent = 'Check Responses';
                resultDiv.innerHTML = `<div class="result error">Error: ${error.message}</div>`;
            }
        }
        
        // Allow Enter key
        document.getElementById('email').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkEmail();
            }
        });
    </script>
</body>
</html>